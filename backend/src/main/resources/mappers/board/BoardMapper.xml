<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nullpointer.domain.board.mapper.BoardMapper">

    <!-- 보드 생성 -->
    <insert id="insertBoard" parameterType="BoardVo"  useGeneratedKeys="true" keyProperty="id">
        INSERT INTO board (title,
                          team_id,
                          description,
                          visibility)
        VALUES (#{title},
                #{teamId},
                #{description},
                #{visibility})
    </insert>

    <!-- 보드 생성 시 생성자를 BoardMember 테이블에 OWNER로 등록 -->
    <insert id="insertBoardMember">
        INSERT INTO board_member (board_id,
                                  user_id,
                                  role)
        VALUES (#{boardId},
                #{userId},
                #{role})
    </insert>


    <!-- 내 보드 목록 조회-->
    <select id="findBoardByUserId" parameterType="Long" resultType="BoardVo">
        SELECT a.id,
               a.title,
               a.description,
               a.visibility,
               b.name AS teamName
        FROM board a,
             team b,
             team_member c
        WHERE a.team_id = b.id
          AND a.team_id = c.team_id
          AND c.user_id = #{id}
          AND a.deleted_at IS NULL
    </select>

    <!-- 특정 팀 보드 목록 조회 -->
    <select id="findBoardByTeamId" parameterType="Long" resultType="BoardVo">
        SELECT id,
               title,
               description,
               visibility
        FROM board
        WHERE team_id = #{id}
          AND deleted_at IS NULL
    </select>

    <!-- 보드 상세 조회 -->
    <select id="findBoardByBoardId" parameterType="Long" resultType="BoardVo">
        SELECT id,
               title,
               description,
               visibility
        FROM board
        WHERE id = #{id}
          AND deleted_at IS NULL
    </select>

    <!-- 보드 정보 수정 -->
    <update id="updateBoard" parameterType="BoardVo">
        UPDATE board
        SET title = #{title},
            description = #{description},
            visibility = #{visibility}
        WHERE id = #{id}
    </update>

    <!-- 보드 삭제 -->
    <update id="deleteBoard">
        UPDATE board
        SET deleted_at = NOW()
        WHERE id = #{id}
    </update>
</mapper>